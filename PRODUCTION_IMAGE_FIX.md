# Инструкция по применению изменений для изображений на продакшене

## Что было изменено

1. **Аксессор `image_url` в модели `Media`** - теперь использует `asset()` для генерации правильных URL
2. **Сохранение новых изображений** - теперь сохраняется относительный путь `/storage/...` вместо полного URL
3. **Команда исправления ссылок** - исправляет все ссылки на изображения в описаниях товаров на относительные пути

## Шаги для применения на продакшене

### 1. Убедитесь, что символическая ссылка существует

```bash
php artisan storage:link
```

### 2. Убедитесь, что папка для изображений существует

```bash
# Папка создастся автоматически при загрузке изображения, но можно создать заранее
mkdir -p storage/app/public/products/images
chmod -R 755 storage/app/public/products/images
```

### 3. Проверьте настройки в `.env`

Убедитесь, что `APP_URL` установлен правильно:
```env
APP_URL=https://einvestor.ru
```

### 4. Запустите команду исправления ссылок (опционально)

Если на продакшене есть товары со старыми ссылками на изображения:

```bash
# Сначала проверьте, что будет исправлено (dry-run)
php artisan products:fix-images-in-description --dry-run

# Затем запустите реальное исправление
php artisan products:fix-images-in-description
```

### 5. Очистите кеш (если используется)

```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
```

## Как это работает

- **Относительные пути** (`/storage/products/images/...`) автоматически адаптируются к текущему домену
- Функция `asset()` использует `APP_URL` из `.env` для генерации правильных URL
- На локальной машине: `http://localhost:8000/storage/...`
- На продакшене: `https://einvestor.ru/storage/...`

## Важно

- Все новые изображения будут автоматически сохраняться с относительными путями
- Старые изображения с полными URL будут автоматически исправляться через аксессор `image_url`
- Команда исправления ссылок безопасна - она не изменяет файлы, только обновляет ссылки в базе данных
