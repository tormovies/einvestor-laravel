# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –†–æ–±–æ–∫–∞—Å—Å—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. RobokassaService
**–§–∞–π–ª:** `app/Services/RobokassaService.php`

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –†–æ–±–æ–∫–∞—Å—Å—ã:
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –æ–ø–ª–∞—Ç—ã (Password1)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Password2)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ URL –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ–ø–ª–∞—Ç—É
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MD5, SHA-256, SHA-512 –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞

### 2. RobokassaController
**–§–∞–π–ª:** `app/Http/Controllers/RobokassaController.php`

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
- ‚úÖ `result()` - –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã (Result URL)
- ‚úÖ `success()` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (Success URL)
- ‚úÖ `fail()` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ—É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (Fail URL)

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `config/robokassa.php`

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `.env`:
```env
ROBOKASSA_MERCHANT_LOGIN=your_merchant_login
ROBOKASSA_PASSWORD1=password1_for_payment
ROBOKASSA_PASSWORD2=password2_for_notifications
ROBOKASSA_HASH_TYPE=md5
ROBOKASSA_IS_TEST=true
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CheckoutController
- ‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –†–æ–±–æ–∫–∞—Å—Å—É
- ‚úÖ –ï—Å–ª–∏ –†–æ–±–æ–∫–∞—Å—Å–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

### 5. –†–æ—É—Ç–∏–Ω–≥
```
POST /robokassa/result  - Webhook –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã (–±–µ–∑ CSRF)
GET  /robokassa/success - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞
GET  /robokassa/fail    - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏
```

### 6. Views
- ‚úÖ `checkout/fail.blade.php` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ—É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏ –æ–ø–ª–∞—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –Ω–∞ `/checkout`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è URL –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –†–æ–±–æ–∫–∞—Å—Å—É
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –†–æ–±–æ–∫–∞—Å—Å—ã

### 2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã (Result URL)
1. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –†–æ–±–æ–∫–∞—Å—Å–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ `/robokassa/result`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å (Password2)
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: `payment_status = 'paid'`, `status = 'processing'`
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç `OK<InvId>`

### 3. –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (Success URL)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/robokassa/success`
2. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/checkout/success/{orderNumber}` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± —É—Å–ø–µ—Ö–µ

### 4. –ù–µ—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (Fail URL)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/robokassa/fail`
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–µ

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```env
ROBOKASSA_MERCHANT_LOGIN=–≤–∞—à_–ª–æ–≥–∏–Ω
ROBOKASSA_PASSWORD1=–ø–∞—Ä–æ–ª—å1
ROBOKASSA_PASSWORD2=–ø–∞—Ä–æ–ª—å2
ROBOKASSA_HASH_TYPE=md5
ROBOKASSA_IS_TEST=true
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –†–æ–±–æ–∫–∞—Å—Å—ã:
- **Result URL:** `https://yourdomain.com/robokassa/result`
- **Success URL:** `https://yourdomain.com/robokassa/success`
- **Fail URL:** `https://yourdomain.com/robokassa/fail`

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è webhook (`robokassa/result`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `ROBOKASSA_IS_TEST=true` –≤ `.env` –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ `/checkout`
2. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –†–æ–±–æ–∫–∞—Å—Å—É
3. –û–ø–ª–∞—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –Ω–∞ `/robokassa/result`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –ë–î

---

## üìã –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞

- `pending` ‚Üí `processing` (–ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)
- `payment_status: pending` ‚Üí `paid` (–ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –†–æ–±–æ–∫–∞—Å—Å—ã –≥–æ—Ç–æ–≤–∞  
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –†–æ–±–æ–∫–∞—Å—Å—ã
